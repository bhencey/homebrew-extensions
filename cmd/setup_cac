#~/bin/sh
function get_cac() {
  KEYID=PIV%20Authentication
  FOUT=cac_token.sh
  echo "Searching for token starting with $LNAME"
  CACCERT=( $(p11tool --list-tokens | grep -oe "token=$LNAME\+[a-zA-Z0-9._]\+") )
  echo "Found token $CACCERT"
  
  echo "Searching for certificate ending with $KEYID"
  CACKEY=( $(p11tool --list-all-certs pkcs11:$CACCERT | grep -oe "$CACCERT\+[a-zA-Z0-9=%.;]\+$KEYID") )
  echo "Found certificate $CACKEY"
}

  
get_cac
echo $CACKEY

#echo "Writing token and certificate to $FOUT"
#set | grep CACCERT > $FOUT
#set | grep CACKEY >> $FOUT
